'use strict';

jQuery(document).ready(function ($) {

	// ===== Products Mega Menu ===== //
	var menuSpeed = 250,
	    menuSpeedFast = 100,
	    menuDelay = 350,
	    fadeOut = false,
	    fadeTimeout;

	function fadeMegaMenu() {
		fadeTimeout = setTimeout(function () {
			if (fadeOut) {
				$('.pmm-sub').fadeOut(menuSpeed);
			}
		}, menuDelay);
	}

	// Products toggle
	$('.pmm').hover(function () {

		// Hover IN
		fadeOut = false;

		$('.pmm-sub').fadeIn(menuSpeed);
	}, function () {

		// Hover Out
		fadeOut = true;
		clearTimeout(fadeTimeout);

		fadeMegaMenu();
	});

	// Category toggles
	$('.pmm-cat').hover(function () {

		// Hover IN
		var catID = $(this).data('id'),
		    box = $('.pmm-box[data-id="' + catID + '"]'),
		    otherBoxes = $('.pmm-box:not([data-id="' + catID + '"])');

		$('.pmm-cat').removeClass('active');
		$(this).addClass('active');

		otherBoxes.removeClass('over').addClass('under');
		box.stop().removeClass('under').addClass('over').fadeIn(menuSpeed);
		otherBoxes.stop().delay(menuSpeed).fadeOut(menuSpeedFast);
	}, function () {

		// Hover Out
		// do nothing!

	});

	// ===== Main Navs ===== //
	var nav = $('#nav'),
	    scrollTop = $(this).scrollTop(),
	    lastScrollTop = $(this).scrollTop(),
	    navHeight = 140,
	    mobileNavHeight = 50,
	    deltaNavHeight = navHeight - mobileNavHeight;

	// Toggle Navs
	function toggleNavs() {

		// Desktop
		if (scrollTop > deltaNavHeight) {
			nav.addClass('small');
		} else {
			nav.removeClass('small');
		}

		// Mobile
		if (scrollTop > lastScrollTop && scrollTop > mobileNavHeight) {
			nav.addClass('mobile-nav-hide');
		} else {
			nav.removeClass('mobile-nav-hide');
		}
	}

	// Check scroll every 0.5s
	var didScroll = false;
	$(window).scroll(function () {
		didScroll = true;
	});
	setInterval(function () {
		if (didScroll) {
			didScroll = false;
			scrollTop = $(this).scrollTop();
			toggleNavs();
			lastScrollTop = scrollTop;
		}
	}, 250);

	// Toggle navs on init
	toggleNavs();

	// ===== Mobile Nav Toggles ===== //

	// Main toggle
	$('.mobile-nav-toggle').click(function () {
		$('body').toggleClass('mobile-nav-active');
	});

	// Search toggle
	$('#mobile-nav-search-toggle').click(function () {
		$('#mobile-nav-search input').focus();
	});

	// ===== Nav sub-menus ===== //

	// Append open/close buttons sub-menus
	$('#main-menu-mobile li').has('.sub-menu').addClass('has-children').append('<div class="expand-btn"></div>');

	// Toggle sub-menus
	$('.expand-btn').click(function () {
		var el = $(this),
		    subMenu = el.siblings('.sub-menu').first(),
		    parent = el.parent(),
		    grandparent = parent.parent();

		if (parent.hasClass('opened')) {
			// close sub-menu
			subMenu.slideUp(300);

			// close children (if any)
			parent.find('.opened .sub-menu').slideUp(300);
			parent.find('.opened').toggleClass('opened');
		} else {
			// open sub-menu
			subMenu.slideDown(300);

			// close other menus (if any are opened)
			grandparent.find('.opened .sub-menu').not(parent).slideUp(300);
			grandparent.find('.opened').not(parent).toggleClass('opened');
		}
		parent.toggleClass('opened');
	});
});

jQuery(document).ready(function ($) {

	// ===== Product Tables Expand ===== //
	$('.table-toggle').click(function () {
		$(this).parent('.table-wrap').toggleClass('minimized maximized');
	});
});

var addTags = function addTags() {
	// Adding tracking tags

	// Global
	var dataAnalytics = 'data-analytics';
	var dataLabel = 'data-label';
	var currentPage = window.location.pathname;
	var isHomePage = currentPage === '/';
	var isContactPage = currentPage === '/contact/';

	var arrayTextFinder = function arrayTextFinder(nodeList, includesText) {
		return Array.from(nodeList).find(function (item) {
			return item.innerText.includes(includesText);
		});
	};

	var arrayHrefMatcher = function arrayHrefMatcher(nodeList, hrefMatch) {
		return Array.from(nodeList).find(function (item) {
			return item.href.includes(hrefMatch);
		});
	};

	var safeSetAttribute = function safeSetAttribute(elmName, elm, attributeName, attributeValue) {
		try {
			return elm.setAttribute(attributeName, attributeValue);
		} catch (error) {
			console.log('GTM Attribute Error: issue with setting attribute for: ' + elmName);
			console.error(elmName + ' error: ', error);
		}
	};

	// MINI TOP NAV
	var secondaryNav = document.querySelector('#nav-sec-menu');

	// Toll Free Phone
	var secondaryNavTollFreePhone = secondaryNav.querySelector('.nsm-phone.nsm-phone-tf a');
	safeSetAttribute('secondaryNavTollFreePhone', secondaryNavTollFreePhone, dataAnalytics, 'top-nav-menu');
	safeSetAttribute('secondaryNavTollFreePhone', secondaryNavTollFreePhone, dataLabel, 'Toll-Free');

	// Local Phone
	var secondaryNavLocalPhone = arrayTextFinder(secondaryNav.querySelectorAll('.nsm-phone a'), '519-745-5925');
	safeSetAttribute('secondaryNavLocalPhone', secondaryNavLocalPhone, dataAnalytics, 'top-nav-menu');
	safeSetAttribute('secondaryNavLocalPhone', secondaryNavLocalPhone, dataLabel, 'Local-Number');

	// MAIN NAV

	// Nav Logo
	var fullTopNav = document.querySelector('#nav');
	var navLogo = fullTopNav.querySelector('#nav-logo');
	safeSetAttribute('navLogo', navLogo, dataAnalytics, 'nav-menu-logo');
	safeSetAttribute('navLogo', navLogo, dataLabel, 'TriPac-Logo');

	var mainMenu = document.querySelector('#main-menu');

	// Products
	var mainMenuProducts = Array.from(mainMenu.querySelectorAll('.pmm a')).find(function (item) {
		return item.innerText.includes('PRODUCTS') && item.href.includes('tripacinc.com/products/');
	});
	safeSetAttribute('mainMenuProducts', mainMenuProducts, dataAnalytics, 'nav-menu');

	// About
	var mainMenuAbout = mainMenu.querySelector('.main-nav__about a');
	safeSetAttribute('mainMenuAbout', mainMenuAbout, dataAnalytics, 'nav-menu');

	// Get A Quote
	var mainMenuGetAQuote = mainMenu.querySelector('.main-nav__get-a-quote a');
	safeSetAttribute('mainMenuGetAQuote', mainMenuGetAQuote, dataAnalytics, 'nav-menu');

	// Contact
	var mainMenuContact = mainMenu.querySelector('.main-nav__contact a');
	safeSetAttribute('mainMenuContact', mainMenuContact, dataAnalytics, 'nav-menu');

	// Poly Products
	var mainMenuPolyProducts = mainMenu.querySelector('.pmm-sub .pmm-cats [data-id="1"] a');
	safeSetAttribute('mainMenuPolyProducts', mainMenuPolyProducts, dataAnalytics, 'nav-menu');

	// Poly CTA
	var mainMenuPolyCTA = mainMenu.querySelector('.pmm-sub .pmm-boxes [data-id="1"] .banner .content .explore');
	safeSetAttribute('mainMenuPolyCTA', mainMenuPolyCTA, dataAnalytics, 'nav-menu-CTA');
	safeSetAttribute('mainMenuPolyCTA', mainMenuPolyCTA, dataLabel, 'CTA-Explore-Poly-Products');

	// Poly Products All
	var mainMenuPolyProductsAll = mainMenu.querySelectorAll('.pmm-box[data-id="1"] .products-list a');
	mainMenuPolyProductsAll.forEach(function (item) {
		safeSetAttribute('mainMenuPolyProductsAll--List', item, dataAnalytics, 'nav-menu-products-poly');
	});

	// Lumber Wrap
	var mainMenuLumberWrap = mainMenu.querySelector('.pmm-sub .pmm-cats [data-id="2"] a');
	safeSetAttribute('mainMenuLumberWrap', mainMenuLumberWrap, dataAnalytics, 'nav-menu');

	// Lumber Wrap CTA
	var mainMenuLumberCTA = mainMenu.querySelector('.pmm-sub .pmm-boxes [data-id="2"] .banner .content .explore');
	safeSetAttribute('mainMenuLumberCTA', mainMenuLumberCTA, dataAnalytics, 'nav-menu-CTA');
	safeSetAttribute('mainMenuLumberCTA', mainMenuLumberCTA, dataLabel, 'CTA-Explore-Lumber-Products');

	// Lumber Wrap All
	var mainMenuLumberWrapAll = mainMenu.querySelectorAll('.pmm-box[data-id="2"] .products-list a');
	mainMenuLumberWrapAll.forEach(function (item) {
		safeSetAttribute('mainMenuLumberWrapAll--List', item, dataAnalytics, 'nav-menu-products-lumber');
	});

	// Heavy Duty Products
	var mainMenuHeavyDuty = mainMenu.querySelector('.pmm-sub .pmm-cats [data-id="3"] a');
	safeSetAttribute('mainMenuHeavyDuty', mainMenuHeavyDuty, dataAnalytics, 'nav-menu');

	// Heavy Duty CTA
	var mainMenuHeavyDutyCTA = mainMenu.querySelector('.pmm-sub .pmm-boxes [data-id="3"] .banner .content .explore');
	safeSetAttribute('mainMenuHeavyDutyCTA', mainMenuHeavyDutyCTA, dataAnalytics, 'nav-menu-CTA');
	safeSetAttribute('mainMenuHeavyDutyCTA', mainMenuHeavyDutyCTA, dataLabel, 'CTA-Explore-Heavy-Duty');

	// Heavy Duty All
	var mainMenuHeavyDutyAll = mainMenu.querySelectorAll('.pmm-box[data-id="3"] .products-list a');
	mainMenuHeavyDutyAll.forEach(function (item) {
		safeSetAttribute('mainMenuHeavyDutyAll--List', item, dataAnalytics, 'nav-menu-products-heavy-duty');
	});

	// FOOTER
	var footer = document.querySelector('#footer');

	// Toll Free
	var footerTollFree = arrayTextFinder(footer.querySelectorAll('.footer-phone a'), '1-888-236-0000');
	safeSetAttribute('footerTollFree', footerTollFree, dataAnalytics, 'footer-menu');
	safeSetAttribute('footerTollFree', footerTollFree, dataLabel, 'Footer-Toll-Free');

	// Local
	var footerLocal = arrayTextFinder(footer.querySelectorAll('.footer-phone a'), '519-745-5925');
	safeSetAttribute('footerLocal', footerLocal, dataAnalytics, 'footer-menu');
	safeSetAttribute('footerLocal', footerLocal, dataLabel, 'Footer-Local-Number');

	// Quote
	var footerQuote = arrayHrefMatcher(footer.querySelectorAll('.footer-link a'), 'tripacinc.com/quote/');
	safeSetAttribute('footerQuote', footerQuote, dataAnalytics, 'footer-menu');
	safeSetAttribute('footerQuote', footerQuote, dataLabel, 'Get-Quote');

	// Contact
	var footerContact = arrayHrefMatcher(footer.querySelectorAll('.footer-link a'), 'tripacinc.com/contact/');
	safeSetAttribute('footerContact', footerContact, dataAnalytics, 'footer-menu');
	safeSetAttribute('footerContact', footerContact, dataLabel, 'Email-Us');

	// Address
	var footerAddress = arrayTextFinder(footer.querySelectorAll('.footer-address a'), '725 McMurray Rd.'.toUpperCase());
	safeSetAttribute('footerAddress', footerAddress, dataAnalytics, 'footer-menu');
	safeSetAttribute('footerAddress', footerAddress, dataLabel, 'Address');

	// HOMEPAGE
	if (isHomePage) {
		var homeIntro = document.querySelector('.flexible-home-intro');

		// Poly Products Explore CTA
		var homePolyExplore = arrayTextFinder(homeIntro.querySelectorAll('.product-cats li a'), 'Poly Products'.toUpperCase());
		safeSetAttribute('homePolyExplore', homePolyExplore, dataAnalytics, 'homepage');
		safeSetAttribute('homePolyExplore', homePolyExplore, dataLabel, 'Explore-Poly-Products');

		// Lumber Wrap Explore CTA
		var homeLumberExplore = arrayTextFinder(homeIntro.querySelectorAll('.product-cats li a'), 'Woven Wraps & Bags'.toUpperCase());
		safeSetAttribute('homeLumberExplore', homeLumberExplore, dataAnalytics, 'homepage');
		safeSetAttribute('homeLumberExplore', homeLumberExplore, dataLabel, 'Explore-Lumber-Wrap-Products');

		// Heavy Duty Explore CTA
		var homeHeavyDutyExplore = arrayTextFinder(homeIntro.querySelectorAll('.product-cats li a'), 'Heavy Duty Products'.toUpperCase());
		safeSetAttribute('homeHeavyDutyExplore', homeHeavyDutyExplore, dataAnalytics, 'homepage');
		safeSetAttribute('homeHeavyDutyExplore', homeHeavyDutyExplore, dataLabel, 'Explore-Heavy-Duty-Products');

		var homeContent = document.querySelector('.flexible-content-cols');

		// Poly - View Products CTA
		var homeContentPolyCTA = arrayTextFinder(homeContent.querySelectorAll('.align-bottom a'), 'View Products'.toUpperCase());
		safeSetAttribute('homeContentPolyCTA', homeContentPolyCTA, dataAnalytics, 'homepage');
		safeSetAttribute('homeContentPolyCTA', homeContentPolyCTA, dataLabel, 'View-Products-CTA');

		// Get a Quote CTA
		var homeContentQuoteCTA = arrayTextFinder(homeContent.querySelectorAll('.align-bottom a'), 'Get a Quote'.toUpperCase());
		safeSetAttribute('homeContentQuoteCTA', homeContentQuoteCTA, dataAnalytics, 'homepage');
		safeSetAttribute('homeContentQuoteCTA', homeContentQuoteCTA, dataLabel, 'Get-A-Quote-CTA');

		// Contact Us CTA
		var homeContentContactCTA = arrayTextFinder(homeContent.querySelectorAll('.align-bottom a'), 'Contact Us'.toUpperCase());
		safeSetAttribute('homeContentContactCTA', homeContentContactCTA, dataAnalytics, 'homepage');
		safeSetAttribute('homeContentContactCTA', homeContentContactCTA, dataLabel, 'Contact-Us-CTA');
	}

	// CONTACT PAGE
	if (isContactPage) {
		// Phones section
		var contactPhones = document.querySelector('.contact-phones');

		// Toll Free
		var contactTollFree = arrayTextFinder(contactPhones.querySelectorAll('li a'), '1-888-236-0000');
		safeSetAttribute('contactTollFree', contactTollFree, dataAnalytics, 'contact');
		safeSetAttribute('contactTollFree', contactTollFree, dataLabel, 'Contact-Toll-Free');

		// Contact Local
		var contactLocal = arrayTextFinder(contactPhones.querySelectorAll('li a'), '519-745-5925');
		safeSetAttribute('contactLocal', contactLocal, dataAnalytics, 'contact');
		safeSetAttribute('contactLocal', contactLocal, dataLabel, 'Contact-Local-Number');
	}
};

if (document.readyState === "complete" || document.readyState !== "loading" && !document.documentElement.doScroll) {
	addTags();
} else {
	document.addEventListener("DOMContentLoaded", addTags);
}